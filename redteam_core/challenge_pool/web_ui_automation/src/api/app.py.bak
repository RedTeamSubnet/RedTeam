from fastapi import FastAPI, Request
from fastapi.staticfiles import StaticFiles

from challenge import Challenge
from api.schemas.data_types import MinerOutput

app = FastAPI()
app.mount("/static", StaticFiles(directory="static"), name="static")
challenge = Challenge()


@app.get("/task")
async def get_task():
    return challenge.prepare_task()


@app.post("/score")
async def score(request: Request):
    data = await request.json()
    miner_output = MinerOutput(**data)
    score = challenge.score_task(miner_output=miner_output)
    return {"score": score}


@app.get("/health")
def health():
    return {"status": "healthy"}
