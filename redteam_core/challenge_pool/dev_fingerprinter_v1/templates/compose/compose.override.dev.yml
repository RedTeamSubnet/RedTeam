services:
  challenger-api:
    volumes:
      - "./volumes/storage/rest.dfp-challenger/logs:${DFP_API_LOGS_DIR:-/var/log/rest.dfp-challenger}"
      - "./volumes/storage/rest.dfp-challenger/data:${DFP_API_DATA_DIR:-/var/lib/rest.dfp-challenger}"
      - "./volumes/storage/rest.dfp-challenger/configs:${DFP_API_CONFIGS_DIR:-/etc/rest.dfp-challenger}"
      - "./scripts/docker/docker-entrypoint.sh:/usr/local/bin/docker-entrypoint.sh"
      - "./src:/app/rest.dfp-challenger"
      - "./volumes/.vscode-server:/home/dfp-user/.vscode-server"
    # deploy:
    #   replicas: 0
    #   resources:
    #     limits:
    #       cpus: "0.5"
    #       memory: 512M
    # command: ["/bin/bash"]
    command: ["-b", "uvicorn main:app --host=0.0.0.0 --port=${DFP_API_PORT:-10001} --no-access-log --no-server-header --proxy-headers --forwarded-allow-ips='*' --reload --reload-include='*.yml' --reload-include='.env'"]
    # healthcheck:
    #   test: ["CMD-SHELL", "curl -f http://localhost:${DFP_API_PORT:-10001}/ping"]
    #   start_period: 30s
    #   start_interval: 1s
    #   interval: 5m
    #   timeout: 5s
    #   retries: 3
